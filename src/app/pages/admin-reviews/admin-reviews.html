<div class="admin-container">
    <header class="admin-header">
        <div class="header-content">
            <h1>Reviews Management</h1>
            <p>Monitor and manage customer feedback</p>
        </div>
        <div class="header-stats">
            <div class="stat-item">
                <span class="stat-val">{{ reviews().length }}</span>
                <span class="stat-label">Total Reviews</span>
            </div>
        </div>
    </header>

    <div class="admin-content">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="search-box">
                <i class="fa fa-search"></i>
                <input type="text" [ngModel]="searchTerm()" (ngModelChange)="updateSearch($event)"
                    placeholder="Search by user, book or comment...">
            </div>

            <div class="filters">
                <select [ngModel]="ratingFilter()" (ngModelChange)="updateRating($event)">
                    <option [value]="0">All Ratings</option>
                    <option [value]="5">5 Stars</option>
                    <option [value]="4">4 Stars</option>
                    <option [value]="3">3 Stars</option>
                    <option [value]="2">2 Stars</option>
                    <option [value]="1">1 Star</option>
                </select>
            </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading()" class="loading-overlay">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">Loading reviews...</p>
        </div>

        <!-- Reviews Table -->
        <div class="table-container" *ngIf="!isLoading()">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Book</th>
                        <th>Rating</th>
                        <th>Comment</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let review of filteredReviews()">
                        <td class="user-cell">
                            <div class="user-info">
                                <span class="fw-bold">{{ getUserName(review) }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="book-name">{{ getBookName(review) }}</span>
                        </td>
                        <td>
                            <app-star-rating [value]="review.rating" [readonly]="true"></app-star-rating>
                        </td>
                        <td class="comment-cell">
                            <p class="review-comment" [title]="review.comment">{{ review.comment }}</p>
                        </td>
                        <td>{{ review.createdAt | date:'shortDate' }}</td>
                        <td>
                            <button class="btn btn-delete" (click)="deleteReview(review._id!)">
                                <i class="fa fa-trash"></i>
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="filteredReviews().length === 0">
                        <td colspan="6" class="empty-state">No reviews found matching your filters.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>