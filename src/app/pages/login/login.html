<div class="auth-page d-flex flex-column">
  <app-nav-bar></app-nav-bar>

  <div class="flex-grow-1 row g-0">
    <!-- Left: form panel -->
    <div class="col-md-6 auth-left d-flex align-items-center justify-content-center p-4 p-xl-5">
      <div class="auth-form-wrapper">

        <!-- Brand -->
        <div class="d-flex align-items-center gap-2 mb-4">
          <img src="logo.png" alt="" class="auth-logo"/>
          <span class="auth-brand-name">Wyrmhole Books</span>
        </div>

        @if (step() === 'credentials') {
          <h1 class="h3 fw-bold mb-1">Login now</h1>
          <p class="text-muted small mb-4">Hi, Welcome back ðŸ‘‹</p>

          <form [formGroup]="credentialsForm" (ngSubmit)="submitCredentials()" novalidate>
            <!-- Email -->
            <div class="mb-3">
              <input
                id="email"
                type="email"
                formControlName="email"
                class="form-control auth-input"
                [class.is-invalid]="emailCtrl.invalid && emailCtrl.touched"
                placeholder="Email"
                autocomplete="email"
              />
              <div class="invalid-feedback">
                @if (emailCtrl.hasError('required')) {
                  Email is required.
                } @else if (emailCtrl.hasError('email')) {
                  Please enter a valid email address.
                }
              </div>
            </div>

            <!-- Password -->
            <div class="mb-4">
              <input
                id="password"
                type="password"
                formControlName="password"
                class="form-control auth-input"
                [class.is-invalid]="passwordCtrl.invalid && passwordCtrl.touched"
                placeholder="Password"
                autocomplete="current-password"
              />
              <div class="invalid-feedback">
                @if (passwordCtrl.hasError('required')) {
                  Password is required.
                } @else if (passwordCtrl.hasError('minlength')) {
                  Password must be at least 6 characters long.
                }
              </div>
            </div>

            @if (errorMessage()) {
              <div class="alert alert-danger py-2 small mb-3" role="alert">{{ errorMessage() }}</div>
            }

              <button
                type="submit"
                class="btn btn-auth-primary w-100"
                [disabled]="isLoading()"
              >
              @if (isLoading()) {
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Signing inâ€¦
              } @else {
                Login
              }
            </button>
          </form>

          <p class="text-center small text-muted mt-4 mb-0">
            Don't have an account?
            <a routerLink="/register" class="auth-link">Sign Up</a>
          </p>
        }

        @if (step() === 'otp') {
          <h1 class="h3 fw-bold mb-1">Verify your email</h1>
          <p class="text-muted small mb-4">
            We sent a 6-digit code to <strong>{{ email() }}</strong>
          </p>

          <form [formGroup]="otpForm" (ngSubmit)="submitOtp()" novalidate>
            <div class="mb-4">
              <label for="otp" class="form-label fw-semibold">One-time password</label>
              <input
                id="otp"
                type="text"
                inputmode="numeric"
                formControlName="otp"
                class="form-control auth-input text-center otp-input"
                [class.is-invalid]="otpCtrl.invalid && otpCtrl.touched"
                placeholder="123456"
                maxlength="6"
                autocomplete="one-time-code"
              />
              <div class="invalid-feedback">
                @if (otpCtrl.hasError('required')) {
                  OTP is required.
                } @else if (otpCtrl.hasError('pattern')) {
                  OTP must be exactly 6 characters.
                }
              </div>
            </div>

            @if (errorMessage()) {
              <div class="alert alert-danger py-2 small mb-3" role="alert">{{ errorMessage() }}</div>
            }

            <button
              type="submit"
              class="btn btn-auth-primary w-100"
              [disabled]="isLoading()"
            >
              @if (isLoading()) {
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Verifyingâ€¦
              } @else {
                Verify &amp; Sign In
              }
            </button>
          </form>

          <button
            type="button"
            class="btn btn-link p-0 text-muted text-decoration-none small mt-3"
            (click)="goBack()"
          >
            <i class="fa fa-arrow-left me-1"></i> Back to login
          </button>
        }

      </div>
    </div>

    <!-- Right: image -->
    <div class="col-md-6 auth-right d-none d-md-flex align-items-center justify-content-center">
      <img src="sign.png" alt="" class="auth-image"/>
    </div>
  </div>
</div>
